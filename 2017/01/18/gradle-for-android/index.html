<!DOCTYPE html><html lang="default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Gradle for Android 笔记 · 王少星的个人博客</title><meta name="description" content="Gradle for Android 笔记 - 王少星"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://wsxyeah.github.io/atom.xml" title="王少星的个人博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/friends/" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Gradle for Android 笔记</h1><div class="post-info">Jan 18, 2017</div><div class="post-content"><h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><ul>
<li>DSL</li>
<li>based on Groovy</li>
<li><code>{}</code>：闭包</li>
</ul>
<a id="more"></a>
<h1 id="Gradle-for-Android"><a href="#Gradle-for-Android" class="headerlink" title="Gradle for Android"></a>Gradle for Android</h1><ul>
<li>用 V 表示集合 Build Variants，T 表示集合 Build Types，F 表示集合 Product Flavors，则 V = T × F。</li>
<li>e.g.</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/build.gradle</span></span><br><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123; <span class="comment">// 当我们在写一个一个的 `&#123;&#125;` 时，其实就是在调用函数，并传一个闭包进去</span></span><br><span class="line">    compileSdkVersion <span class="number">25</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"me.sxwang.explore"</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">25</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">            manifestPlaceholders = [CHANNEL: <span class="string">"official"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里的 productFlavors 对应</span></span><br><span class="line">    <span class="comment">// void productFlavors(Action&lt;? super NamedDomainObjectContainer&lt;ProductFlavor&gt;&gt; action)</span></span><br><span class="line">    <span class="comment">// 方法，执行该方法内部会调用 action.execute(produtFlavors)。</span></span><br><span class="line">    <span class="comment">// productFlavors 的实际类型为 NamedDomainObjectContainer&lt;ProductFlavor&gt;，</span></span><br><span class="line">    <span class="comment">// NamedDomainObjectContainer 是 Gradle 中定义的一个接口</span></span><br><span class="line">    <span class="comment">// （https://docs.gradle.org/current/dsl/org.gradle.api.NamedDomainObjectContainer.html），</span></span><br><span class="line">    <span class="comment">// 闭包内的代码通过 create(name, configureClosure) ／getByName(name, configureClosure) </span></span><br><span class="line">    <span class="comment">// 方法实现了对 productFlavors 的配置</span></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        wandoujia &#123;</span><br><span class="line">            manifestPlaceholders = [CHANNEL: <span class="string">"wandoujia"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        xiaomi &#123;</span><br><span class="line">            manifestPlaceholders = [CHANNEL: <span class="string">"xiaomi"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里的 productFlavors 对应调用 getProductFlavors() 方法，返回类型为 Collection&lt;ProductFlavor&gt;，</span></span><br><span class="line">    <span class="comment">// Collection 是 Groovy JDK 提供的类（http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Collection.html）</span></span><br><span class="line">    <span class="comment">// each() 方法遍历集合中的所有元素，在 Collection 中定义</span></span><br><span class="line">    <span class="comment">// 可见这里使用 each() 仅对前面已经创建的 product flavors 生效</span></span><br><span class="line">    productFlavors.<span class="keyword">each</span> &#123; flavor -&gt;</span><br><span class="line">        <span class="keyword">println</span>(<span class="string">"====&gt; Configuring productFlavor: $&#123;flavor.name&#125;"</span>)</span><br><span class="line">        flavor.manifestPlaceholders = [CHANNEL: flavor.name]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// applicationVariants 为 DomainObjectSet&lt;ApplicationVariant&gt; 类型，</span></span><br><span class="line">    <span class="comment">// 虽然也是 Collection 类型，但是此时其集合元素为空，故使用 each() 无效。</span></span><br><span class="line">    <span class="comment">// 当然 DomainObjectSet 也实现了另一个接口 DomainObjectCollection，接口中定义的</span></span><br><span class="line">    <span class="comment">// all() 方法保证对于后续添加的所有元素都会生效</span></span><br><span class="line">    applicationVariants.all &#123; variant -&gt;</span><br><span class="line">        <span class="keyword">println</span>(<span class="string">"====&gt; Configuring variant: $&#123;variant.name&#125;"</span>)</span><br><span class="line">        variant.assemble.dependsOn.<span class="keyword">each</span> &#123; dependency -&gt;</span><br><span class="line">            <span class="keyword">println</span>(dependency)</span><br><span class="line">        &#125;</span><br><span class="line">        variant.outputs.<span class="keyword">each</span> &#123; output -&gt;</span><br><span class="line">            output.outputFile = <span class="keyword">new</span> <span class="keyword">File</span>(output.outputFile.parent, <span class="string">"x-$&#123;variant.name&#125;.apk"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        variant.assemble.<span class="keyword">doFirst</span> &#123;</span><br><span class="line">            <span class="keyword">println</span>(<span class="string">"====&gt; doFirst: $&#123;variant.name&#125;"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:25.1.0'</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:design:25.1.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p><a target="_blank" href="http://docs.groovy-lang.org/latest/html/groovy-jdk/">Groovy JDK API Documentation</a></p>
</li>
<li><p><a target="_blank" href="https://docs.gradle.org/current/dsl/">Gradle Build Language Reference</a></p>
</li>
<li><p><a target="_blank" href="https://docs.gradle.org/current/userguide/userguide.html">Gradle User Guide</a></p>
</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2017/04/05/Marshmallow-Runtime-Permissions/" class="prev">PREV</a><a href="/2016/11/01/java-wrapper-classes/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="https://wsxyeah.github.io">王少星</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>